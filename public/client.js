async function loadProducts(){const res = await fetch('/api/products');const products = await res.json();const grid = document.getElementById('grid');grid.innerHTML = '';products.forEach(p=>{const card=document.createElement('article');card.className='card';card.innerHTML=`<div class="card-img">${p.name}</div><h4>${p.name}</h4><p>${p.desc||''}</p><div class="price">R$ ${p.price.toFixed(2)}</div><div class="actions"><button class="btn" onclick="buy('${p.id}')">Comprar</button><button class="small" onclick="preview('${p.id}')">Detalhes</button></div>`;grid.appendChild(card);});}async function buy(id){const name=prompt('Qual seu nome?');const email=prompt('Qual seu email? (onde receberá o código)');if(!name||!email){alert('Nome e email são necessários');return;}const res=await fetch('/api/create-charge',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({productId:id,name,email})});const data=await res.json();if(data.pix_copy||data.qr_base64){openModal(data);}else{alert('Erro: '+(data.error||'unknown'));}}function preview(id){fetch('/api/products').then(r=>r.json()).then(products=>{const p=products.find(x=>x.id===id);alert(p.name+'\n\n'+p.desc+'\n\nPreco: R$ '+p.price.toFixed(2));});}function openModal(data){document.getElementById('pixModal').style.display='flex';const c=document.getElementById('pixContent');c.innerHTML=''; if(data.qr_base64){const img=document.createElement('img');img.src='data:image/png;base64,'+data.qr_base64;img.style.maxWidth='100%';c.appendChild(img);} if(data.pix_copy){const pre=document.createElement('pre');pre.style.whiteSpace='pre-wrap';pre.textContent='Copiar Pix: '+data.pix_copy; c.appendChild(pre);} }function closeModal(){document.getElementById('pixModal').style.display='none';}window.addEventListener('load',loadProducts);